import Head from 'next/head'
import { useEffect } from 'react'
import { supabase } from '../utils/supabaseClient'
import { definitions } from '../models/supabase'

export default function Home() {
  useEffect(() => {
    const getAuth = async () => {

      // 1a) Get a list of amenities
      var { data, error } = await supabase.rpc('amenity_list')

      // 1b) Loop through amenities, get their locations
      if (!error && data) {
        data.forEach(function (amenity) {
          console.log(amenity.name)
          amenity.locations.forEach(function (location: definitions['locations']) {
            console.log("\t" + location.name)
          })
        })
      }

      // 2a) Get a list of services
      var { data, error } = await supabase.rpc('service_list')

      // 2b) Loop through services, get their programs and tags
      if (!error && data) {
        data.forEach(function (service) {
          console.log(service.name)
          console.log("\tprograms:")
          service.programs.forEach(function (program: definitions['programs']) {
            console.log("\t\t" + program.name)
          })
          console.log("\ttags:")
          service.tags.forEach(function (tag: definitions['tags']) {
            console.log("\t\t" + tag.name)
          })
        })
      }

      // 3a) Get a list of programs
      var { data, error } = await supabase.rpc('program_list')

      // 3b) Loop through programs, get their department and services
      if (!error && data) {
        data.forEach(function (program) {
          console.log(program.name)
          console.log("\tdepartment: " + program.department)
          console.log("\tservices:")
          program.services.forEach(function (service: definitions['services']) {
            console.log("\t\t" + service.name)
          })
        })
      }

      // 4) Get a list of tags (categories)
      var result = await supabase.from<definitions['tags']>('tags').select('*')
      if (!result.error && result.data) {
        const tags = result.data
        tags.forEach(function (tag) {
          console.log(tag.name, tag.preferred)
        })
      }

      // 4) Get a list of departments
      var result2 = await supabase.from<definitions['departments']>('departments').select('*')
      if (!result.error && result2.data) {
        const departments = result.data
        departments.forEach(function (department) {
          console.log(department.name)
        })
      }
    }
    getAuth()
  }, [])

  return (
    <div>
      <Head>
        <title>myGNV Resource Finder</title>
        <meta name='description' content='Generated by create next app' />
        <link rel='icon' href='/favicon.ico' />
      </Head>
      <main>
        <h1>Resource Finder</h1>
      </main>
    </div>
  )
}
